global
    log stdout format raw local0
    maxconn 4096

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

# Statistics page (optional, useful for debugging)
listen stats
    bind *:9999
    stats enable
    stats uri /stats
    stats refresh 5s

# Frontend - receives requests from clients
frontend taiji_frontend
    bind *:8080
    default_backend taiji_backend

    # Preserve client IP in X-Forwarded-For header
    option forwardfor

# Backend - load balances to 2 Taiji instances
backend taiji_backend
    balance roundrobin
    option httpchk GET /health

    # Forward original client IP
    http-request set-header X-Forwarded-For %[src]

    # Taiji instances
    server taiji-1 taiji-1:8080 check
    server taiji-2 taiji-2:8080 check
